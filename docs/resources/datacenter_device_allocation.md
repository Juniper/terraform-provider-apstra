---
page_title: "apstra_datacenter_device_allocation Resource - terraform-provider-apstra"
subcategory: "Reference Design: Datacenter"
description: |-
  This resource allocates a Managed Device (probably a switch) to a node role (spine1, etc...) within a Blueprint.
---

# apstra_datacenter_device_allocation (Resource)

This resource allocates a Managed Device (probably a switch) to a node role (spine1, etc...) within a Blueprint.


## Example Usage

```terraform
# This example deploys a blueprint from a template and assigns
# interface maps to the fabric nodes.

# Instantiate the blueprint from the template
resource "apstra_datacenter_blueprint" "r" {
  name        = "example blueprint with switch allocation"
  template_id = "L2_Virtual_EVPN"
}

# Only one of "device_key" and "initial_interface_map_id" is required in
# most cases.
#
# When only the initial_interface_map_id is provided, we set the interface
# map (this step eliminates build errors), but do not assign systems by ID.
#
# When only the device_key is provided, we try to infer the
# initial_interface_map_id by first determining the device type, and then
# looking for candidate interface maps which can map the specific hardware
# to the logical device specified by the fabric role. When multiple
# candidate interface maps exist supplying initial_interface_map_id becomes
# mandatory.
locals {
  switches = {
    spine1 = {
      #     device_key       = "<serial-number-goes-here>"
      initial_interface_map_id = "Juniper_vQFX__AOS-7x10-Spine"
    }
    spine2 = {
      #     device_key       = "<serial-number-goes-here>"
      initial_interface_map_id = "Juniper_vQFX__AOS-7x10-Spine"
    }
    l2_virtual_001_leaf1 = {
      #     device_key       = "<serial-number-goes-here>"
      initial_interface_map_id = "Juniper_vQFX__AOS-7x10-Leaf"
    }
    l2_virtual_002_leaf1 = {
      #     device_key       = "<serial-number-goes-here>"
      initial_interface_map_id = "Juniper_vQFX__AOS-7x10-Leaf"
    }
    l2_virtual_003_leaf1 = {
      #     device_key       = "<serial-number-goes-here>"
      initial_interface_map_id = "Juniper_vQFX__AOS-7x10-Leaf"
    }
    l2_virtual_004_leaf1 = {
      #     device_key       = "<serial-number-goes-here>"
      initial_interface_map_id = "Juniper_vQFX__AOS-7x10-Leaf"
    }
  }
}

# Assign switches to fabric roles
resource "apstra_datacenter_device_allocation" "r" {
  for_each                 = local.switches
  blueprint_id             = apstra_datacenter_blueprint.r.id
  initial_interface_map_id = each.value["initial_interface_map_id"]
  node_name                = each.key
  deploy_mode              = "deploy"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `blueprint_id` (String) Apstra Blueprint ID.
- `node_name` (String) Graph node label which identifies the switch. Strings like 'spine1' and 'rack_2_leaf_1' are appropriate here.

### Optional

- `deploy_mode` (String) Set the [deploy mode](https://www.juniper.net/documentation/us/en/software/apstra4.1/apstra-user-guide/topics/topic-map/datacenter-deploy-mode-set.html) of the associated fabric node.
- `device_key` (String) Unique ID for a Managed Device, generally the serial number, used to assign a Managed Device to a fabric role.
- `initial_interface_map_id` (String) Interface Maps link a Logical Device (fabric design element) to a Device Profile (description of a specific hardware model). The value of this field must be the graph node ID (bootstrapped from Global Catalog ID) of an Interface Map. A value is required when `device_key` is omitted, or when `device_key` is supplied, but does not provide enough information to automatically select an Interface Map. The ID is used only at resource creation (in the initial `apply` operation) and for replacement when the configuration is modified. Apstra flexible fabric expansion operations should not trigger state churn due to the current Interface Map ID being inconsistent with the configured value.

### Read-Only

- `device_profile_node_id` (String) Device Profiles specify attributes of specific hardware models.
- `interface_map_name` (String) The Interface Map Name is recorded only at creation time toaid in detection of changes to the Interface Map made outside of Terraform.
- `node_id` (String) Graph node ID of the fabric node to which we're allocating an Interface Map (and possibly a Managed Device.)
