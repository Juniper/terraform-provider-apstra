---
page_title: "apstra_datacenter_virtual_network Resource - terraform-provider-apstra"
subcategory: "Reference Design: Datacenter"
description: |-
  This resource creates a Virtual Network within a Blueprint.
---

# apstra_datacenter_virtual_network (Resource)

This resource creates a Virtual Network within a Blueprint.


## Example Usage

```terraform
# The following example creates a VXLAN Virtual Network and makes it
# available on 3 switches in rack "a" and one switch in rack "b".
#
# Note that computing the 'bindings' data requires knowledge of the
# topological relationship between leaf and access switches, ESI/MLAG
# redundancy group relationships and graph db node IDs of switch and
# group nodes.
#
# Users are encouraged to use the `apstra_datacenter_systems`
# and `apstra_datacenter_virtual_network_binding_constructor` data sources to
# produce the 'bindings' data.

resource "apstra_datacenter_virtual_network" "test" {
  name                         = "test"
  blueprint_id                 = "blueprint-id"
  type                         = "vxlan"
  routing_zone_id              = "routing-zone-id"
  ipv4_connectivity_enabled    = true
  ipv4_virtual_gateway_enabled = true
  ipv4_virtual_gateway         = "192.168.10.1"
  ipv4_subnet                  = "192.168.10.0/24"
  bindings = {
    "leaf-a" = {
      "access_ids" = [ "access-a-1", "access-a-2" ]
    },
    "leaf-b" = {
      "access_ids" = []
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `blueprint_id` (String) Blueprint ID
- `name` (String) Virtual Network Name

### Optional

- `bindings` (Attributes Map) Bindings make a Virtual Network available on Leaf Switches and Access Switches. At least one binding entry is required with Apstra 4.x. With Apstra 5.x, a Virtual Network with no bindings can be created by omitting (or setting `null`) this attribute. The value is a map keyed by graph db node IDs of *either* Leaf Switches (non-redundant Leaf Switches) or Leaf Switch redundancy groups (redundant Leaf Switches). Practitioners are encouraged to consider using the [`apstra_datacenter_virtual_network_binding_constructor`](../data-sources/datacenter_virtual_network_binding_constructor) data source to populate this map. (see [below for nested schema](#nestedatt--bindings))
- `description` (String) Virtual Network Description
- `dhcp_service_enabled` (Boolean) Enables a DHCP relay agent.
- `export_route_targets` (Set of String) Export RTs for this Virtual Network.
- `import_route_targets` (Set of String) Import RTs for this Virtual Network.
- `ipv4_connectivity_enabled` (Boolean) Enables IPv4 within the Virtual Network. Default: true
- `ipv4_subnet` (String) IPv4 subnet associated with the Virtual Network. When not specified, a prefix from within the IPv4 Resource Pool assigned to the `virtual_network_svi_subnets` role will be automatically assigned by Apstra.
- `ipv4_virtual_gateway` (String) Specifies the IPv4 virtual gateway address within the Virtual Network. The configured value must be a valid IPv4 host address configured value within range specified by `ipv4_subnet`
- `ipv4_virtual_gateway_enabled` (Boolean) Controls and indicates whether the IPv4 gateway within the Virtual Network is enabled. Requires `ipv4_connectivity_enabled` to be `true`
- `ipv6_connectivity_enabled` (Boolean) Enables IPv6 within the Virtual Network. Default: false
- `ipv6_subnet` (String) IPv6 subnet associated with the Virtual Network. When not specified, a prefix from within the IPv6 Resource Pool assigned to the `virtual_network_svi_subnets_ipv6` role will be automatically assigned by Apstra.
- `ipv6_virtual_gateway` (String) Specifies the IPv6 virtual gateway address within the Virtual Network. The configured value must be a valid IPv6 host address configured value within range specified by `ipv6_subnet`
- `ipv6_virtual_gateway_enabled` (Boolean) Controls and indicates whether the IPv6 gateway within the Virtual Network is enabled. Requires `ipv6_connectivity_enabled` to be `true`
- `l3_mtu` (Number) L3 MTU used by the L3 switch interfaces participating in the Virtual Network. Must be an even number between 1280 and 9216. Requires Apstra 4.2.0 or later.
- `reserve_vlan` (Boolean) For use only with `vxlan` type Virtual networks when all `bindings` use the same VLAN ID. This option reserves the VLAN fabric-wide, even on switches to which the Virtual Network has not yet been deployed. The only accepted values is `true`.
- `routing_zone_id` (String) Routing Zone ID (required when `type == vxlan`
- `type` (String) Virtual Network Type
- `vni` (Number) EVPN Virtual Network ID to be associated with this Virtual Network.  When omitted, Apstra chooses a VNI from the Resource Pool [allocated](../resources/datacenter_resource_pool_allocation) to role `vni_virtual_network_ids`.

### Read-Only

- `had_prior_vni_config` (Boolean) Used to trigger plan modification when `vni` has been removed from the configuration.
- `id` (String) Apstra graph node ID.

<a id="nestedatt--bindings"></a>
### Nested Schema for `bindings`

Optional:

- `access_ids` (Set of String) The graph db node ID of the access switch `system` node (nonredundant access switch) or `redundancy_group` node (ESI LAG access switches) beneath `leaf_id` to which this VN should be bound.
- `vlan_id` (Number) When not specified, Apstra will choose the VLAN to be used on each switch.



