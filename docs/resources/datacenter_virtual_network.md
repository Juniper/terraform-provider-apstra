---
page_title: "apstra_datacenter_virtual_network Resource - terraform-provider-apstra"
subcategory: "Reference Design: Datacenter"
description: |-
  This resource creates a Virtual Network within a Blueprint.
---

# apstra_datacenter_virtual_network (Resource)

This resource creates a Virtual Network within a Blueprint.


## Example Usage

```terraform
# The following example creates a VXLAN Virtual Network and makes it
# available on 3 switches in rack "a" and one switch in rack "b".
#
# Note that computing the 'bindings' data requires knowledge of the
# topological relationship between leaf and access switches, ESI/MLAG
# redundancy group relationships and graph db node IDs of switch and
# group nodes.
#
# Users are encouraged to use the `apstra_datacenter_systems`
# and `apstra_datacenter_virtual_network_binding_constructor` data sources to
# produce the 'bindings' data.

resource "apstra_datacenter_virtual_network" "test" {
  name                         = "test"
  blueprint_id                 = "blueprint-id"
  type                         = "vxlan"
  routing_zone_id              = "routing-zone-id"
  ipv4_connectivity_enabled    = true
  ipv4_virtual_gateway_enabled = true
  ipv4_virtual_gateway         = "192.168.10.1"
  ipv4_subnet                  = "192.168.10.0/24"
  bindings = {
    "leaf-a" = {
      "access_ids" = [ "access-a-1", "access-a-2" ]
    },
    "leaf-b" = {
      "access_ids" = []
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `blueprint_id` (String) Blueprint ID
- `name` (String) Virtual Network Name

### Optional

- `bindings` (Attributes Map) Bindings make a Virtual Network available on Leaf Switches and Access Switches. At least one binding entry is required with Apstra 4.x. With Apstra 5.x, a Virtual Network with no bindings can be created by omitting (or setting `null`) this attribute. The value is a map keyed by graph db node IDs of *either* Leaf Switches (non-redundant Leaf Switches) or Leaf Switch redundancy groups (redundant Leaf Switches). Practitioners are encouraged to consider using the [`apstra_datacenter_virtual_network_binding_constructor`](../data-sources/datacenter_virtual_network_binding_constructor) data source to populate this map. (see [below for nested schema](#nestedatt--bindings))
- `description` (String) Virtual Network Description
- `dhcp_service_enabled` (Boolean) Enables a DHCP relay agent.
- `export_route_targets` (Set of String) Export RTs for this Virtual Network.
- `import_route_targets` (Set of String) Import RTs for this Virtual Network.
- `ipv4_connectivity_enabled` (Boolean) Enables IPv4 within the Virtual Network. Default: true
- `ipv4_subnet` (String) IPv4 subnet associated with the Virtual Network. When not specified, a prefix from within the IPv4 Resource Pool assigned to the `virtual_network_svi_subnets` role will be automatically assigned by Apstra.
- `ipv4_virtual_gateway` (String) Specifies the IPv4 virtual gateway address within the Virtual Network. The configured value must be a valid IPv4 host address configured value within range specified by `ipv4_subnet`
- `ipv4_virtual_gateway_enabled` (Boolean) Controls and indicates whether the IPv4 gateway within the Virtual Network is enabled. Requires `ipv4_connectivity_enabled` to be `true`
- `ipv6_connectivity_enabled` (Boolean) Enables IPv6 within the Virtual Network. Default: false
- `ipv6_subnet` (String) IPv6 subnet associated with the Virtual Network. When not specified, a prefix from within the IPv6 Resource Pool assigned to the `virtual_network_svi_subnets_ipv6` role will be automatically assigned by Apstra.
- `ipv6_virtual_gateway` (String) Specifies the IPv6 virtual gateway address within the Virtual Network. The configured value must be a valid IPv6 host address configured value within range specified by `ipv6_subnet`
- `ipv6_virtual_gateway_enabled` (Boolean) Controls and indicates whether the IPv6 gateway within the Virtual Network is enabled. Requires `ipv6_connectivity_enabled` to be `true`
- `l3_mtu` (Number) L3 MTU used by the L3 switch interfaces participating in the Virtual Network. Must be an even number between 1280 and 9216. Requires Apstra 4.2.0 or later.
- `reserve_vlan` (Boolean) For use only with `vxlan` type Virtual networks when all `bindings` use the same VLAN ID. This option reserves the VLAN fabric-wide, even on switches to which the Virtual Network has not yet been deployed.
- `reserved_vlan_id` (Number) Used to specify the reserved VLAN ID without specifying any *bindings*.
- `routing_zone_id` (String) Routing Zone ID (required when `type == vxlan`
- `svi_ips` (Block Set) SVI IP assignments for switches in the virtual network. This allows explicit control over the secondary virtual interface IPs assigned to switches, preventing overlaps when identical virtual networks are created in multiple blueprints. (see [below for nested schema](#nestedatt--svi_ips))
- `type` (String) Virtual Network Type
- `vni` (Number) EVPN Virtual Network ID to be associated with this Virtual Network.  When omitted, Apstra chooses a VNI from the Resource Pool [allocated](../resources/datacenter_resource_pool_allocation) to role `vni_virtual_network_ids`.

### Read-Only

- `had_prior_vni_config` (Boolean) Used to trigger plan modification when `vni` has been removed from the configuration.
- `id` (String) Apstra graph node ID.

<a id="nestedatt--bindings"></a>
### Nested Schema for `bindings`

Optional:

- `access_ids` (Set of String) The graph db node ID of the access switch `system` node (nonredundant access switch) or `redundancy_group` node (ESI LAG access switches) beneath `leaf_id` to which this VN should be bound.
- `vlan_id` (Number) When not specified, Apstra will choose the VLAN to be used on each switch.

<a id="nestedatt--svi_ips"></a>
### Nested Schema for `svi_ips`

Required:

- `system_id` (String) System ID of the switch for this SVI IP assignment.

Optional:

- `ipv4_address` (String) IPv4 address with CIDR notation (e.g., '192.0.2.2/24').
- `ipv4_mode` (String) SVI IPv4 mode: 'disabled', 'enabled', or 'forced'. Default: "enabled".
- `ipv6_address` (String) IPv6 address with CIDR notation (e.g., '2001:db8::2/64').
- `ipv6_mode` (String) SVI IPv6 mode: 'disabled', 'enabled', 'forced', or 'link_local'. Default: "disabled".

## SVI IP Management

The `svi_ips` attribute allows explicit control over Secondary Virtual Interface IPs (SVI IPs) assigned to switches in a virtual network. This is particularly useful for multi-datacenter deployments where preventing IP overlaps between identical virtual networks in different datacenters is important.

### Example with SVI IPs

```terraform
svi_ips {
  system_id    = apstra_datacenter_device_allocation.leaf1.system_id
  ipv4_address = "192.0.2.2/24"
  ipv4_mode    = "enabled"
}

svi_ips {
  system_id    = apstra_datacenter_device_allocation.leaf2.system_id
  ipv4_address = "192.0.2.3/24"
  ipv4_mode    = "enabled"
}
```


